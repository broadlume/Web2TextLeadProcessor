name: Docker Compose Action

on: [push]
env: # Or as an environment variable
  TWILIO_ACCOUNT_SID: ${{ secrets.TWILIO_ACCOUNT_SID }}
  TWILIO_AUTH_TOKEN: ${{ secrets.TWILIO_AUTH_TOKEN }}
  HUSKY: 0
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Git Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
      - name: Copy Test ENV vars
        run: cp .env.test .env
      - name: Start Services
        uses: hoverkraft-tech/compose-action@v2.2.0
        with:
          compose-file: ./docker-compose.test.yaml
          up-flags: --build --force-recreate
      - name: Wait for Services To Be Ready
        run: sleep 5
      - name: Run E2E Tests
        run: docker compose -f ./docker-compose.test.yaml exec web2text bun run e2e